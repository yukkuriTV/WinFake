【概要】

Windows 10上で実行したアプリケーションに対してWindows 11 25H2であると返すプログラム。

【使い方】

1　まず、管理者権限で、Launcher.exe（32bitアプリケーションであると事前に分かっている場合はInjectorx86.exe）を起動します。ただし、API.exeが管理者権限を必要としない場合、ユーザー権限で起動しても問題ありません。

2　Launcher.exeで［対象プロセスを監視して起動］を選び、API.exeを登録します。※まだAPI.exeは起動しません。

3　新しくLauncher.exeを立ち上げ（監視中のLauncher.exeを閉じないでください。）、今度は［通常の起動］を選択します。

4　ファイル選択ダイアログが表示されるので、ここでD/API.exeを選択し、実行します。

5　確実な初回フック（［通常の起動］の機能）とフックへの耐性機能を無効化した状態（［対象プロセスを監視して起動］の繰り返しフック機能）で実行することができます。

【トラブルシューティング】

ケース1　［通常の起動］で選択すると、プロセス起動失敗と出る。次に［対象プロセスを監視して起動］で起動すると、プロセスが認識されないか、注入失敗と出る。

解決策　これは権限不足により発生します。Launcher.exeを管理者として実行してください。なお、Launcher.exeを管理者として実行するとそこから実行する全てのアプリと32bitアプリケーションで自動的に起動するInjectorx86.exeは管理者権限で動作します。

【レジストリサポート】

WinFake 2.0以降の計画においてレジストリサポートの予定とWinFake 2.0における実験的な導入が行われていましたが、次の理由により廃止されました。

1　レジストリフックを行うことにより、通常の関数のフックが大幅に遅延する。

2　これにより、起動が早い一部のアプリケーションのフックが困難になる。

3　レジストリサポートの実現が、他の有益が開発を遅延させる。

【フック対象の関数】

ここでは、フック対象の関数をご説明します。

・RtlGetVersion

・RtlGetNtVersionNumbers

・GetVersionEx

・VerifyVersionInfo

RtlGetVersion、RtlGetNtVersionNumbers、GetVersionExは次のように返します。

MAJOR 10

MINOR 0

BUILD 26200

VerifyVersionInfoは次のように返します。

TRUE

SetLastError　ERROR_SUCCESS

【サポートされるOS】

Windows 10以降

今後、サポート対象をWindows 7以降へと拡大するため、以下の問題の解決に取り組んでいます。

・IsWow64Process2を持たないバージョンの作成

・Windows 7で動作するバージョンのLauncher.exeにおいて［通常の起動］［対象プロセスを監視して起動］の文字が正しく表示されない。

しかしご安心ください！現在のバージョンでもIsWow64Process2を持たないInjectorx86.exeにおいては文字は表示されませんが、機能自体は動作することを確認しています。あと一歩です！


